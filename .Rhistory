names(currpreg)
currpreg$lmpdate
raw_pheno <- read_csv(file = "Data/Phenotypic_Data/full_nsf_w_covariates.csv") %>%
clean_names()
library(tidyverse)
library(janitor)
library(skimr)
library(corrplot)
raw_pheno <- read_csv(file = "Data/Phenotypic_Data/full_nsf_w_covariates.csv") %>%
clean_names()
81.18 + 442.33 + 40.52 + 178.26 + 187.04
550 - 929.33
550 - 379.33
# Calculate gestation age
names(currpreg)
#Loading packages
library(tidyverse)
library(janitor)
library(skimr)
library(corrplot)
raw_pheno <- read_csv(file = "Data/Phenotypic_Data/full_nsf_w_covariates.csv") %>%
clean_names()
# Calculate gestation age
names(currpreg)
raw_pheno
library(haven)
birth <- read_dta("Data/Phenotypic_Data/final NSF IC Female Pregnancy Tracking files/Birth files/corrected Stata files/birthinfo_20141016.dta")
View(birth)
birth
library(haven)
currpreg <- read_dta("Data/Phenotypic_Data/final NSF IC Female Pregnancy Tracking files/Pregnancy files/corrected Stata files/currpreg20141016.dta")
View(currpreg)
currpreg <- read_dta("Data/Phenotypic_Data/final NSF IC Female Pregnancy Tracking files/Pregnancy files/corrected Stata files/currpreg20141016.dta")
currpreg
birth
raw_pheno <- read_csv(file = here::here("Data/Phenotypic_Data/full_nsf_w_covariates.csv")) %>%
clean_names()
raw_pheno
raw_pheno %>% select(date_prg_term, date_preg_term)
currpreg
currpreg %>%
select(uncchdid, nsfnumb, pregord, lmpdate, durmonth)
birth
currpreg_dates <- read_dta("Data/Phenotypic_Data/final NSF IC Female Pregnancy Tracking files/Pregnancy files/corrected Stata files/currpreg20141016.dta") %>%
select(uncchdid, nsfnumb, pregord, lmpdate, durmonth)
left_join(raw_pheno, currpreg_dates, by = c("uncchdid", "nsfnumb", "pregord"))
left_join(raw_pheno, currpreg_dates, by = c("uncchdid", "nsfnumb"))
raw_pheno
left_join(raw_pheno, currpreg_dates, by = c("uncchdid", "nsfnumb", "pregord" = "pregord_all"))
left_join(raw_pheno, currpreg_dates, by = c("uncchdid", "nsfnumb", "pregord_all" = "pregord"))
raw_pheno <-left_join(raw_pheno, currpreg_dates, by = c("uncchdid", "nsfnumb", "pregord_all" = "pregord"))
skim(raw_pheno)
raw_pheno$bday
raw_pheno <- raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate)
raw_pheno
raw_pheno$gestage
raw_pheno <- raw_pheno %>%
mutate(gestage = months(date_preg_term - lmpdate))
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, date)
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome)
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
skim()
6*30
# CPR: So basically create gestation age and convert to months
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
print(nrow = -Inf)
# CPR: So basically create gestation age and convert to months
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
print(-Inf)
# CPR: So basically create gestation age and convert to months
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
print(Inf)
# CPR: So basically create gestation age and convert to months
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
print(n = -Inf)
# CPR: So basically create gestation age and convert to months
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
print(n = Inf)
# CPR: So basically create gestation age and convert to months
raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
ggplot(., aes(x = durmonth, y = gestage))+
geom_point()
# CPR: So basically create gestation age and convert to months
ga_file <-raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
# Ok I have very little faith in durmonth as a variable - it shows almost no relationship with number of dates between lmp and date_preg_term. Chris used it, I don't think this is a good appraoch.
** there are 30 values above 301 (43 weeks) and some quite high.  Will infer an approx birth date
# CPR: So basically create gestation age and convert to months
ga_file <-raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
ga_file %>%
ggplot(., aes(x = gestage))+
geom_histogram()
# CPR: So basically create gestation age and convert to months
ga_file <-raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome) %>%
ga_file %>%
ggplot(., aes(x = gestage))+
geom_histogram()
# CPR: So basically create gestation age and convert to months
ga_file <-raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome)
ga_file %>%
ggplot(., aes(x = gestage))+
geom_histogram()
ga_file %>%
filter(gestage >0)
ga_file %>%
filter(gestage >0) %>%
ggplot(., aes(x = gestage))+
geom_histogram()
ga_file
ga_file %>%
filter(gestage >0)
ga_file %>%
filter(gestage >0 | is.na(gestage))
ga_file %>%
filter(gestage >0 | is.na(gestage)) %>%
ggplot(., aes(x = gestage))+
geom_histogram()
raw_pheno
read_dta("Data/Phenotypic_Data/final NSF IC Female Pregnancy Tracking files/Pregnancy files/corrected Stata files/currpreg20141016.dta")
# Load raw pheno
raw_pheno
# Create ga_file
ga_file <-raw_pheno %>%
mutate(gestage = date_preg_term - lmpdate) %>%
select(uncchdid, lmpdate, date_preg_term, gestage, durmonth, outcome, date_preg_anthro)
# Create ga_file
ga_file
raw_pheno %>%
filter(is.na(lmpdate))
#CPR
# Does this even make sense?
ga_file %>%
filter(is.na(lmpdate))
#CPR
# Does this even make sense?
ga_file %>%
filter(is.na(lmpdate) & !is.na(durmonth))
ga_file %>%
ggplot(., aes(x = gestage))+
geom_histogram()
# Who is it?
ga_file %>%
filter(gestage <0)
ga_file[ga_file$uncchdid == "23228", lmpdate]
ga_file[ga_file$uncchdid == "23228", "lmpdate"]
ga_file[ga_file$uncchdid == "23228", "lmpdate"] <-2010-02-15
ga_file[ga_file$uncchdid == "23228", "lmpdate"] <-as_date("2010-02-15")
ga_file[ga_file$uncchdid == "23228", "lmpdate"] <-ymd("2010-02-15")
library(lubridate)
ga_file[ga_file$uncchdid == "23228", "lmpdate"] <-as_date("2010-02-15")
ga_file[ga_file$uncchdid == "23228", "lmpdate"]
ga_file %>%
mutate(gestage = date_preg_term - lmpdate) %>%
ga_file %>%
filter(gestage >0 | is.na(gestage)) %>%
ggplot(., aes(x = gestage))+
geom_histogram()
ga_file
ga_file[ga_file$uncchdid == "23228", "lmpdate"]
ga_file %>%
mutate(gestage = date_preg_term - lmpdate)
ga_file %>%
ggplot(., aes(x = gestage))+
geom_histogram()
ga_file <-ga_file %>%
mutate(gestage = date_preg_term - lmpdate)
ga_file %>%
ggplot(., aes(x = gestage))+
geom_histogram()
ga_file %>%
filter(gestage < 269 | gestage > 308)
gestage < 269 |
ga_file %>%
filter(gestage > 308)
ga_file %>%
filter(gestage > 308)
ga_file %>%
filter(gestage < 269)
ga_file %>%
filter(gestage > 308)
ga_file %>%
mutate(gestage_long = date_preg_anthro - months(durmonth))
months(durmonth)
months(ga_file$durmonth)
ga_file %>%
mutate(gestage_long = date_preg_anthro - as.interval(ga_file$durmonth, units = "months"))
as.interval(ga_file$durmonth, units = "months")
as_duration(ga_file$durmonth, units = "months")
as_duration(ga_file$durmonth, units = "months")
as.duration(ga_file$durmonth, units = "months")
ga_file$durmonth
as.duration(as.numeric(ga_file$durmonth), units = "months")
as.interval(as.numeric(ga_file$durmonth), units = "months")
dmonths(as.numeric(ga_file$durmonth), units = "months")
dmonths(as.numeric(ga_file$durmonth))
ga_file %>%
mutate(gestage_long = date_preg_anthro - dmonths(as.numeric(durmonth))
)
ga_file %>%
mutate(gestage_long = date_preg_anthro - dmonths(as.numeric(durmonth))
)
ga_file %>%
mutate(gestage_long = date_preg_anthro - dmonths(as.numeric(durmonth))) %>%
filter(gestage > 308)
ga_file %>%
mutate(back_calc_lmp = date_preg_anthro - dmonths(as.numeric(durmonth))) %>%
filter(gestage > 308) %>%
mutate(gestage_rm_long = date_preg_term - back_calc_lmp)
ga_file %>%
mutate(back_calc_lmp = as_date(date_preg_anthro - dmonths(as.numeric(durmonth)))) %>%
filter(gestage > 308)
ga_file %>%
mutate(back_calc_lmp = as_date(date_preg_anthro - dmonths(as.numeric(durmonth)))) %>%
filter(gestage > 308) %>%
mutate(gestage_rm_long = date_preg_term - back_calc_lmp)
dmonths(as.numeric(durmonth)
dmonths(as.numeric(ga_file$durmonth))
dmonths(as.numeric(ga_file$durmonth+0.5))
ga_file %>%
mutate(back_calc_lmp = as_date(date_preg_anthro - dmonths(as.numeric(durmonth)+0.5))) %>%
filter(gestage > 308) %>%
mutate(gestage_rm_long = date_preg_term - back_calc_lmp)
ga_file %>%
mutate(back_calc_lmp = as_date(date_preg_anthro - dmonths(as.numeric(durmonth)))) %>%
filter(gestage > 308) %>%
mutate(gestage_rm_long = date_preg_term - back_calc_lmp)
5*30
ga_file %>%
mutate(back_calc_lmp = as_date(date_preg_anthro - dmonths(as.numeric(durmonth)+0.5))) %>%
filter(gestage > 308) %>%
mutate(gestage_rm_long = date_preg_term - back_calc_lmp)
ga_file %>%
mutate(back_calc_lmp = as_date(date_preg_anthro - dmonths(as.numeric(durmonth)))) %>%
filter(gestage > 308) %>%
mutate(gestage_rm_long = date_preg_term - back_calc_lmp)
ga_file <-ga_file %>%
mutate(back_calc_lmp = as_date(date_preg_anthro - dmonths(as.numeric(durmonth))))
ga_file %>% filter(is.na(gestage))
ga_file
# If is.na(gestage) | gestage > 308
# # If there is a back_calc_lmp (from durmonth), mutate(gestage_rm_long = date_preg_term - back_calc_lmp)
# # Otherwise
ga_file %>% filter(is.na(gestage))
ga_file$gestage)
mean(ga_file$gestage)
mean(ga_file$gestage, na.omit = TRUE)
ga_file$gestage
mean(as_numeric(ga_file$gestage, na.omit = TRUE))
mean(as_numeric(ga_file$gestage), na.omit = TRUE)
mean(as_numeric(ga_file$gestage), na.omit = TRUE)
mean(as.numeric(ga_file$gestage), na.omit = TRUE)
mean(as.numeric(ga_file$gestage), na.rm = TRUE)
mean(ga_file$gestage, na.rm = TRUE)
sd(ga_file$gestage, na.rm = TRUE)
rnorm(mean(ga_file$gestage, na.rm = TRUE), sd(ga_file$gestage, na.rm = TRUE))
mean(ga_file$gestage, na.rm = TRUE)
sd(ga_file$gestage, na.rm = TRUE)
rnorm(mean = mean(ga_file$gestage, na.rm = TRUE), sd = sd(ga_file$gestage, na.rm = TRUE))
rnorm(n = 6, mean = mean(ga_file$gestage, na.rm = TRUE), sd = sd(ga_file$gestage, na.rm = TRUE))
ga_file %>% filter(is.na(gestage))
# Create rnorm for gestation ages
gest_ages <-rnorm(n = 200, mean = mean(ga_file$gestage, na.rm = TRUE), sd = sd(ga_file$gestage, na.rm = TRUE))
# Create rnorm for gestation ages
impute_gest_ages <-rnorm(n = 200, mean = mean(ga_file$gestage, na.rm = TRUE), sd = sd(ga_file$gestage, na.rm = TRUE))
impute_gest_ages
ga_file %>%
mutate(best_gestage_icc = sample(impute_gest_ages))
# Create rnorm for gestation ages
impute_gest_ages <-rnorm(n = 400, mean = mean(ga_file$gestage, na.rm = TRUE), sd = sd(ga_file$gestage, na.rm = TRUE))
ga_file %>%
mutate(best_gestage_icc = sample(impute_gest_ages))
ga_file %>%
mutate(if_else(is.na(gestage) |
gestage > 308,
date_preg_term - back_calc_lmp))
ga_file %>%
mutate(if_else(is.na(gestage) |
gestage > 308,
date_preg_term - back_calc_lmp, 20))
ga_file %>%
mutate(if_else(is.na(gestage) |
gestage > 308,
date_preg_term - back_calc_lmp, gestage))
# First
ga_file <-ga_file %>%
mutate(best_gestage_icc = if_else(is.na(gestage) |
gestage > 308,
date_preg_term - back_calc_lmp, gestage))
ga_file
# Now, fill in the missing gestation ages.
install.packages("mice")
library(mice)
imputed_ga <- mice(ga_file, m=5, maxit = 50, method = 'pmm', seed = 500)
ga_file
m=5, maxit = 50, method = 'pmm', seed = 500)
imputed_ga <- mice(ga_file %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc),
imputed_ga <- mice(ga_file %>%
select(unccchdid, outcome, best_gestage_icc) %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc)),
m=5, maxit = 50, method = 'pmm', seed = 500)
imputed_ga <- mice(ga_file %>%
select(uncchdid, outcome, best_gestage_icc) %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc)),
m=5, maxit = 50, method = 'pmm', seed = 500)
imputed_ga
imputed_ga$imp$best_gestage_icc
mean(imputed_ga$imp$best_gestage_icc)
rowMeans(imputed_ga$imp$best_gestage_icc)
imputed_ga <- mice(ga_file %>%
select(best_gestage_icc) %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc)),
m=5, maxit = 50, method = 'pmm', seed = 500)
left_join(ga_file, raw_pheno, by = "uncchdid")
left_join(ga_file, raw_pheno)
left_join(ga_file, raw_pheno) %>% filter(sample_type == "p")
left_join(ga_file, raw_pheno) %>% skim()
left_join(ga_file, raw_pheno) %>%
select(best_gestage_icc, pregord_all, age_nsf_sample, height, weight_nsf)
ga_file_for_imput <-left_join(ga_file, raw_pheno) %>%
select(best_gestage_icc, pregord_all, age_nsf_sample, height, weight_nsf)
imputed_ga <- mice(ga_file_for_impute %>%
select(best_gestage_icc) %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc)),
m=5, maxit = 50, method = 'pmm', seed = 500)
ga_file_for_imput <-left_join(ga_file, raw_pheno) %>%
select(best_gestage_icc, pregord_all, age_nsf_sample, height, weight_nsf)
imputed_ga <- mice(ga_file_for_impute %>%
select(best_gestage_icc) %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc)),
m=5, maxit = 50, method = 'pmm', seed = 500)
ga_file_for_impute <-left_join(ga_file, raw_pheno) %>%
select(best_gestage_icc, pregord_all, age_nsf_sample, height, weight_nsf)
imputed_ga <- mice(ga_file_for_impute %>%
select(best_gestage_icc) %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc)),
m=5, maxit = 50, method = 'pmm', seed = 500)
imputed_ga <- mice(ga_file_for_impute %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc)),
m=5, maxit = 50, method = 'pmm', seed = 500)
## Look at imputed results (5 iterations)
imputed_ga$imp$best_gestage_icc
rowMeans(imputed_ga$imp$best_gestage_icc)
fit <- with(data = ga_file_for_impute, exp = lm(best_gest_icc ~ pregord_all + age_nsf_sample + height + weight_nsf))
fit <- with(data = ga_file_for_impute, exp = lm(best_gestage_icc ~ pregord_all + age_nsf_sample + height + weight_nsf))
fit
summary(fit)
fit <- with(data = ga_file_for_impute, exp = lm(sjlabelled::as_numeric(best_gestage_icc) ~ pregord_all + age_nsf_sample + height + weight_nsf))
summary(fit)
pool(fit)
fitted <- with(data = ga_file_for_impute, exp = lm(sjlabelled::as_numeric(best_gestage_icc) ~ pregord_all + age_nsf_sample + height + weight_nsf))
summary(fitted)
pool(fitted)
summary(fitted)
rowMeans(imputed_ga$imp$best_gestage_icc)
imputed_ga_means <-rowMeans(imputed_ga$imp$best_gestage_icc)
ga_file %>%
mutate(imputed_ga_means = rowMeans(imputed_ga$imp$best_gestage_icc))
## Look at imputed results (5 iterations)
imputed_ga$imp$best_gestage_icc
rowMeans(imputed_ga$imp$best_gestage_icc)
raw_pheno
raw_pheno$sample_type
ga_file_for_impute <-left_join(ga_file, raw_pheno %>% sample_type == "pregnancy") %>%
select(best_gestage_icc, pregord_all, age_nsf_sample, height, weight_nsf)
ga_file_for_impute <-left_join(ga_file,
raw_pheno %>%
filter(sample_type == "pregnancy")) %>%
select(best_gestage_icc, pregord_all, age_nsf_sample, height, weight_nsf)
imputed_ga <- mice(ga_file_for_impute %>%
mutate(best_gestage_icc = sjlabelled::as_numeric(best_gestage_icc)),
m=5, maxit = 50, method = 'pmm', seed = 500)
## Look at imputed results (5 iterations)
imputed_ga$imp$best_gestage_icc
ga_file %>%
mutate(imputed_ga_means = rowMeans(imputed_ga$imp$best_gestage_icc))
imputed_ga$imp$best_gestage_icc
rowMeans(imputed_ga$imp$best_gestage_icc)
complete(imputed_ga, 2)
rowMeans(imputed_ga$imp$best_gestage_icc)
unlist(rowMeans(imputed_ga$imp$best_gestage_icc))
class(rowMeans(imputed_ga$imp$best_gestage_icc))
str(rowMeans(imputed_ga$imp$best_gestage_icc))
labelled::remove_attributes(rowMeans(imputed_ga$imp$best_gestage_icc))
imputed_ga$imp$best_gestage_icc
row.names(ga_impute_means)
ga_impute_means <-rowMeans(imputed_ga$imp$best_gestage_icc)
row.names(ga_impute_means)
ga_impute_means
row.names(ga_impute_means)
rownames(ga_impute_means)
rownames(ga_impute_means) <c()
ga_file %>%
mutate(imputed_ga_means = rowMeans(imputed_ga$imp$best_gestage_icc))
ga_file %>%
mutate(best_gestage_icc = if_else(is.na(gestage) & is.na(best_gestage_icc), ga_impute_means))
ga_file %>%
mutate(imputed_ga_means = rowMeans(imputed_ga$imp$best_gestage_icc))
ga_file$imputed_ga_means = rowMeans(imputed_ga$imp$best_gestage_icc)
ga_file
rowMeans(imputed_ga$imp$best_gestage_icc)
ga_file
ga_file %>%
filter(if_else(is.na(gestage) & is.na(best_gestage_icc))
ga_file %>%
filter(if_else(is.na(gestage) & is.na(best_gestage_icc)))
ga_file %>%
filter(if_else(is.na(gestage) & is.na(best_gestage_icc)))
ga_file
ga_file %>%
filter(if_else(is.na(gestage) & is.na(best_gestage_icc)))
ga_file %>%
filter(is.na(gestage) & is.na(best_gestage_icc))
ga_file %>%
filter(is.na(gestage) & is.na(best_gestage_icc))%>%
mutate(imputed_ga_means = rowMeans(imputed_ga$imp$best_gestage_icc))
ga_file %>%
mutate(best_gestage_icc = if_else(is.na(gestage) &
is.na(best_gestage_icc),
ga_impute_means,
best_gestage_icc))
imputed_ga
ga_file_for_impute
imputed_ga
ga_file$imputed_ga_means <-NA
ga_file[is.na(ga_file$gestage) & is.na(ga_file$best_gestage_icc),]
ga_file[is.na(ga_file$gestage) & is.na(ga_file$best_gestage_icc), imputed_ga_means] <-rowMeans(imputed_ga$imp$best_gestage_icc)
ga_file[is.na(ga_file$gestage) & is.na(ga_file$best_gestage_icc), "imputed_ga_means"] <-rowMeans(imputed_ga$imp$best_gestage_icc)
ga_file$imputed_ga_means <-0
ga_file[is.na(ga_file$gestage) & is.na(ga_file$best_gestage_icc), "imputed_ga_means"] <-rowMeans(imputed_ga$imp$best_gestage_icc)
ga_file
ga_file %>%
mutate(best_or_imputed_gestage_icc = if_else(is.na(gestage) &
is.na(best_gestage_icc),
imputed_ga_means,
best_gestage_icc))
ga_file %>%
mutate(best_or_imputed_gestage_icc = if_else(is.na(gestage) &
is.na(best_gestage_icc),
imputed_ga_means,
as_numeric(best_gestage_icc)))
ga_file %>%
mutate(best_or_imputed_gestage_icc = if_else(is.na(gestage) &
is.na(best_gestage_icc),
imputed_ga_means,
sjlabelled::as_numeric(best_gestage_icc)))
ga_file %>%
mutate(best_or_imputed_gestage_icc = if_else(is.na(gestage) &
is.na(best_gestage_icc),
imputed_ga_means,
sjlabelled::as_numeric(best_gestage_icc))) %>%
select(-uncchdid)
ga_file %>%
mutate(best_or_imputed_gestage_icc = if_else(is.na(gestage) &
is.na(best_gestage_icc),
imputed_ga_means,
sjlabelled::as_numeric(best_gestage_icc))) %>%
select(-uncchdid, -impute_ga_means)
ga_file %>%
mutate(best_or_imputed_gestage_icc = if_else(is.na(gestage) &
is.na(best_gestage_icc),
imputed_ga_means,
sjlabelled::as_numeric(best_gestage_icc))) %>%
select(-uncchdid, -imputed_ga_means)
ga_file_done_imp <-ga_file %>%
mutate(best_or_imputed_gestage_icc = if_else(is.na(gestage) &
is.na(best_gestage_icc),
imputed_ga_means,
sjlabelled::as_numeric(best_gestage_icc)))
ga_file_done_imp %>%
ggplot(., aes(x = best_or_imputed_gestage_icc))+
geom_histogram()
summary(ga_file_done_imp)
# Ok, now I have to filter out the final ones that didn't get fixed...
ga_file_done_imp %>%
filter(best_or_imputed_gestage_icc > 308)
select(uncchdid, best_or_imputed_gestage_icc)
ga_file_done_imp
left_join(raw_pheno,
ga_file_done_imp %>%
select(uncchdid, best_or_imputed_gestage_icc))
best_or_imputed_gestage_icc
raw_pheno_gest_impute <-left_join(raw_pheno,
ga_file_done_imp %>%
select(uncchdid, best_or_imputed_gestage_icc))
write_csv(raw_pheno_gest_impute, file = here::here("Output/Data/raw_pheno_gest_impute.csv"))
